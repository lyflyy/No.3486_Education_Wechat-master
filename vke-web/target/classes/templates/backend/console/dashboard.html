<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="backend/fragment/frag :: common_header(~{::title},_)">
    <title>知识猫 - 运营系统</title>
</head>

<body class="gray-bg">

    <div class="wrapper wrapper-content animated fadeInRight">
        <!--统计信息(开始)-->
        <div class="row">
            <div class="col-sm-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-success pull-right">当前时间</span>
                        <h5>正在直播</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins"><span th:text="${liveCourseCount}"></span></h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-success pull-right">全站</span>
                        <h5>总用户数</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins"><span th:text="${totalUserCount}"></span></h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-success pull-right">全站</span>
                        <h5>总课程数</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins"><span th:text="${totalCourseCount}"></span></h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-success pull-right">全站</span>
                        <h5>总收益</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins"><span th:text="${#numbers.formatDecimal(totalIncome,1,2,'COMMA')}"></span></h1>
                    </div>
                </div>
            </div>
        </div>
        <!--统计信息(结束)-->
        <!--用户数图表(开始)-->
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>用户</h5>
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" onclick="location.href='/backend/console/dashboard?tab=1';" th:class="${#strings.append('btn btn-xs btn-white',tab eq 1 ?' active':'')}">天</button>
                                <button type="button" onclick="location.href='/backend/console/dashboard?tab=2';" th:class="${#strings.append('btn btn-xs btn-white',tab eq 2 ?' active':'')}">月</button>
                                <button type="button" onclick="location.href='/backend/console/dashboard?tab=3';" th:class="${#strings.append('btn btn-xs btn-white',tab eq 3 ?' active':'')}">年</button>
                                <!--<button type="button" onclick="location.href='/backend/console/dashboard?tab=4';" th:class="${#strings.append('btn btn-xs btn-white',tab eq 4 ?' active':'')}">年</button>-->
                            </div>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-sm-9">
                                <div class="flot-chart">
                                    <div class="flot-chart-content" id="flot-dashboard-chart"></div>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <ul class="stat-list">
                                    <li>
                                        <h2 class="no-margins"><span th:text="${allCourseUserCount}"></span></h2>
                                        <small>报名总数</small>
                                        <!--<div class="stat-percent">48% <i class="fa fa-level-up text-navy"></i>
                                        </div>
                                        <div class="progress progress-mini">
                                            <div style="width: 48%;" class="progress-bar"></div>
                                        </div>-->
                                    </li>
                                    <li>
                                        <h2 class="no-margins "><span th:text="${monthCourseUserCount}"></span></h2>
                                        <small>最近一个月报名数</small>
                                        <!--<div class="stat-percent">60% <i class="fa fa-level-down text-navy"></i>
                                        </div>
                                        <div class="progress progress-mini">
                                            <div style="width: 60%;" class="progress-bar"></div>
                                        </div>-->
                                    </li>
                                    <li>
                                        <h2 class="no-margins "><span th:text="${#numbers.formatDecimal(monthCourseSignFee,1,2,'COMMA')}"></span></h2>
                                        <small>最近一个月报名费用</small>
                                        <!--<div class="stat-percent">22% <i class="fa fa-bolt text-navy"></i>
                                        </div>
                                        <div class="progress progress-mini">
                                            <div style="width: 22%;" class="progress-bar"></div>
                                        </div>-->
                                    </li>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <input id="statisticId" type="hidden" th:value="${statisticInfo}"/>
        <input id="typeId" type="hidden" th:value="${tab}"/>
        <!--用户数图表(结束)-->
        <!--讲师数图表(开始)-->
        <!--讲师数图表(结束)-->
        <!--优质讲师数图表(开始)-->
        <!--优质讲师数图表(结束)-->
    </div>
    <script src="/public/js/jquery.min.js?v=2.1.4"></script>
    <script src="/public/js/bootstrap.min.js?v=3.3.6"></script>
    <script src="/public/js/plugins/flot/jquery.flot.js"></script>
    <script src="/public/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="/public/js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="/public/js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="/public/js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="/public/js/plugins/flot/jquery.flot.symbol.js"></script>
    <script src="/public/js/plugins/peity/jquery.peity.min.js"></script>
    <script src="/public/js/demo/peity-demo.min.js"></script>
    <script src="/public/js/plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="/public/js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="/public/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="/public/js/plugins/easypiechart/jquery.easypiechart.js"></script>
    <script src="/public/js/plugins/sparkline/jquery.sparkline.min.js"></script>
    <script src="/public/js/demo/sparkline-demo.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            var statisticInfo = $.parseJSON($("#statisticId").val());
            var userStatistic = statisticInfo.userStatistic;
            var userCourseStatistic = statisticInfo.userCourseStatistic;
            console.info(userStatistic);
            console.info(userCourseStatistic);
            var type = $("#typeId").val();
            var userArr = [];
            var userCourseArr = [];
            var tickSize = "";
            var barWidth = 0;
            if(userStatistic!=null && userStatistic.length>0&&userCourseStatistic!=null&&userCourseStatistic.length>0 ){
                for(var index in userStatistic){
                    var userInfo =userStatistic[index];
                    var userCourseInfo = userCourseStatistic[index];
                    var showTimeStr = userInfo.showTime;
                    var showTimeArr = showTimeStr.split("-");
                    var showTime = null ;
                    if(type == 1){
                        tickSize = [3,'day'];
                        showTime = gd(showTimeArr[0],showTimeArr[1],showTimeArr[2])
                        barWidth = 24 * 60 * 60 * 600;
                    }else if(type==2){
                        tickSize = [1,'month'];
                        showTime = gd(showTimeArr[0],showTimeArr[1],0)
                        barWidth = 24 * 60 * 60 * 6000;
                    }else if(type==3){
                        tickSize = [1,'year'];
                        showTime = gd(showTimeArr[0],0,0)
                        barWidth = 24 * 60 * 60 * 60000;
                    }
                    var userShowArr = [];
                    var userCourseShowArr = [];
                    userShowArr.push(showTime,userInfo.count);
                    userCourseShowArr.push(showTime,userCourseInfo.count);
                    userArr.push(userShowArr);
                    userCourseArr.push(userCourseShowArr);
                }
            }

            var dataset = [{
                label: "用户数",
                data: userArr,
                color: "#1ab394",
                bars: {
                    show: true,
                    align: "center",
                    barWidth: barWidth,
                    lineWidth: 0
                }
            }, {
                label: "课程报名数",
                data: userCourseArr,
                yaxis: 1,
                color: "#464f88",
                lines: {
                    lineWidth: 1,
                    show: true,
                    fill: true,
                    fillColor: {
                        colors: [{
                            opacity: 0.2
                        }, {
                            opacity: 0.2
                        }]
                    }
                },
                splines: {
                    show: false,
                    tension: 0.6,
                    lineWidth: 8,
                    fill: 0.1
                },
            }];
            var options = {
                xaxis: {
                    mode: "time",
                    tickSize: tickSize,
                    tickLength: 0,
                    axisLabel: "Date",
                    //labelWidth:5,
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: "Arial",
                    axisLabelPadding: 10,
                    color: "#838383"
                },
                yaxes: [{
                    position: "left",
                    //max: 100,
                    color: "#838383",
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: "Arial",
                    axisLabelPadding: 3
                }/*, {
                    position: "right",
                    clolor: "#838383",
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: " Arial",
                    axisLabelPadding: 67
                }*/],
                legend: {
                    noColumns: 1,
                    labelBoxBorderColor: "#000000",
                    position: "nw"
                },
                grid: {
                    hoverable: false,
                    borderWidth: 0,
                    color: "#838383"
                }
            };

            function gd(year, month, day) {
                return new Date(year, month - 1, day).getTime()
            }
            var previousPoint = null,
                previousLabel = null;
            $.plot($("#flot-dashboard-chart"), dataset, options);
        });
    </script>

</body>

</html>